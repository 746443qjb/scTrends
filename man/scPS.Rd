% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/scPS.R
\name{scPS}
\alias{scPS}
\title{Automatic parameter selection for scTrends}
\usage{
scPS(
  scbin_result,
  test_genes = 500,
  sample_method = "stratified",
  threshold_method = "quantile",
  optimize_gam_k = TRUE,
  plot = TRUE,
  verbose = TRUE,
  return_features = FALSE
)
}
\arguments{
\item{scbin_result}{An object of class \code{"scBin"} produced by \code{\link[=scBin]{scBin()}}.}

\item{test_genes}{Integer. Maximum number of genes to use for parameter
optimization. When \code{sample_method != "none"}, this is the target
number of sampled genes. Default: 500.}

\item{sample_method}{Character string specifying how to sample genes:
\itemize{
\item \code{"stratified"}: stratified sampling across CV tertiles.
\item \code{"random"}: uniform random sampling.
\item \code{"none"}: use all genes (no sampling).
}}

\item{threshold_method}{Method used to derive feature thresholds.
Currently \code{"quantile"} (data-driven) or \code{"default"} (fixed defaults).}

\item{optimize_gam_k}{Logical. If \code{TRUE}, search over a grid of \code{k}
values (basis dimension for GAM smooth) and choose the value that
minimizes mean GCV across sampled genes. If \code{FALSE}, use a heuristic
\code{gam_k} based on the number of bins.}

\item{plot}{Logical. If \code{TRUE}, produce a multi-panel diagnostic
plot summarizing parameter selection and feature distributions.}

\item{verbose}{Logical. If \code{TRUE}, print progress and summary messages.}

\item{return_features}{Logical. If \code{TRUE}, return raw feature vectors
used for threshold derivation.}
}
\value{
An object of class \code{"scPS"}, which is a list with components:
\describe{
\item{optimal_params}{List of core parameters suitable for passing
to \code{\link[=scTrends]{scTrends()}} (e.g. \code{gam_k}, \code{stable_cv_threshold},
\code{min_peak_prominence}, \code{total_change_up}, etc.).}
\item{feature_stats}{(Optional) List of feature vectors used during
optimization, returned if \code{return_features = TRUE}.}
\item{metadata}{List with metadata about the optimization procedure,
such as number of genes tested, candidate \code{k} values and scores,
sampling and threshold methods, and timestamp.}
}
}
\description{
\code{scPS()} performs automatic selection of core parameters used by
\code{\link[=scTrends]{scTrends()}} based on a subset of genes taken from a binned
pseudotime dataset generated by \code{\link[=scBin]{scBin()}}.

The function:
\enumerate{
\item Samples genes (optionally in a stratified manner).
\item Optionally optimizes the GAM smoothness parameter \code{gam_k}
using mean GCV across sampled genes.
\item Extracts curve-shape and variability features from GAM fits
(e.g. CV, range, prominence, slopes, monotonicity, residual variance).
\item Derives data-driven thresholds for the trend classifier
used in \code{\link[=scTrends]{scTrends()}} (stable, monotone, peak-like, complex).
\item Optionally visualizes diagnostic distributions and GAM fits.
}

The resulting \code{optimal_params} list is designed to be passed directly
into \code{\link[=scTrends]{scTrends()}} (e.g. via \code{do.call()}).
}
\examples{
\dontrun{
  # sb <- scBin(seurat_obj, pseudotime_col = "pseudotime")
  ps <- scPS(sb, test_genes = 1000, sample_method = "stratified")

  # Use optimal parameters in scTrends:
  trends <- do.call(
    scTrends,
    c(list(scbin_result = sb), ps$optimal_params)
  )
}

}
